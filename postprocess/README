# Postprocessing for NA-CORDEX-CMIP6
# ----------------------------------


## Current workflow and usage instructions 
1. Edit "write.cmd.py" to include the time range (in years) and 
   variables of interest for postprocessing. Make sure to add the correct
   "wrfout_path" which points to the location of the wrf_d01 data. This
   workflow works with the directory structure of NA-CORDEX-CMIP6 runs 
   and would need to be modified to work for other wrf runs. 

2. Run "write.cmd.py" to generate a command file for launch_cf.

3. Inspect your command file to be sure it's what you expect. 

4. Run launch_cf : to divert stderr/stdout, this is the recommended syntax

launch_cf -A ${PBS_ACCOUNT} -l walltime=1:00:00 --mem 150GB -o /dev/null -e /dev/null -k oe ./cmdfile

5. The script takes some time for the year (15 minutes) and takes 
   even longer for precip becuase it's aggregating multiple hourly
   variables from WRF. 


## List of current known problems: 
1.  Discrepancy in cell_methods from WRF output and WCRP guidelines

As the variable attributes are read in from the
official WCRP JSON tables, there are currently disconnects
between the stated attribute of a variable and the actual
attribute of that variable come from WRF. 

The post-processing script does correct the units of the 
core variables, but the likely discrepancy is in the
"cell_methods" attribute. This is important, because of how
variables with different cell methods are given time_bnds and 
the time dimension is directly edited to provide the needed information
on time-scales for means and maximimums. 

I think, the current problematic variables are:

a. clt (cloud fraction)
b. evspsbl (evaporation including subplimation and transpiration) 
